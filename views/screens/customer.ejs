<%- include('../partials/header.ejs') %>

<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>User List</h2>
    <!-- Add New User -->
     <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
      Add User
    </button>
  </div>

  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>SN</th>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Created At</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <%allUser.forEach((item, index) => {%>
      <tr>
        <td><%= index + 1 %></td>
        <td><%= item.id %></td>
        <td><%= item.name %></td>
        <td><%= item.email%></td>
        <td><%= item.role%></td>
        <td><%= item.created_at%></td>
        <td>
          <a href="/customer/edit/<%= item.id %>" class="btn btn-sm btn-warning">Edit</a>
          <form action="/customer/delete/<%= item.id %>" method="POST" class="d-inline">
            <button
              type="submit"
              class="btn btn-sm btn-danger"
              onclick="return confirm('Are you sure you want to delete this user?')"
            >
              Delete
            </button>
          </form>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>
</div>


<!-- User Modal -->
 <!-- Adding category modal -->
 <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="backdrop-filter: blur(10px);">
      <div class="modal-header">
        <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <form id="userForm" action="/customer" method="POST">
        <div class="modal-body">
          <div class="mb-3">
            <label for="name" class="form-label">User Full Name</label>
            <input type="text" class="form-control" name="name" id="name" required />
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" name="email" id="email" required />
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" name="password" id="password" required />
          </div>
          <div class="btn-group">
              <button class="btn btn-dark dropdown-toggle" id="roleDropdown" type="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                Select Role
              </button>

              <ul class="dropdown-menu">
                <li class="dropdown-item" data-value="User" aria-required="true">
                  User
                </li>
                <li class="dropdown-item" data-value="Admin">Admin</li>
              </ul>
            </div>

            <!-- Hidden input to submit role -->
            <input type="hidden" name="role" id="selectedRole" />
        </div>
        <div class="modal-footer">
          <button id="saveUser" type="submit" class="btn btn-success">Save User</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Script -->
<script>
    document.querySelectorAll(".dropdown-item").forEach((item) => {
      item.addEventListener("click", function (e) {
        e.preventDefault();
        const role = this.getAttribute("data-value");
        document.getElementById("selectedRole").value = role;
        document.getElementById("roleDropdown").innerText = role;
      });
    });

    document.getElementById("userForm").addEventListener("submit", function () {
      let btn = document.getElementById("saveUser");
      btn.disabled = true; // disable to prevent double-click
      btn.innerHTML = `
        <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
        <span role="status"> Loading...</span>
    `;
      setTimeout(() => { }, 3000);
    });
  </script>



<%- include('../partials/fixedFooter.ejs') %>

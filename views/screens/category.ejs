<%- include('../partials/header.ejs') %>
<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Category List</h2>
    <!-- Add New Category -->
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
      Add Category
    </button>
  </div>

  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>SN</th>
        <th>Name</th>
        <th>Description</th>
        <th>Created At</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
        <%category.forEach((item, index) => {%>
      <tr>
        <td><%= index + 1 %></td>
        <td><%= item.name %></td>
        <td><%= item.description%></td>
        <td><%= item.created_at%></td>
        <td>
          <a href="/category/edit/<%= item.id %>" class="btn btn-sm btn-warning">Edit</a>
          <form action="/category/<%= item.id %>?_method=DELETE" method="POST" class="d-inline">
            <button type="submit" class="btn btn-sm btn-danger"
              onclick="return confirm('Are you sure you want to delete this category?')">
              Delete
            </button>
          </form>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>
</div>


<!-- Adding category modal -->
 <div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="backdrop-filter: blur(10px);">
      <div class="modal-header">
        <h5 class="modal-title" id="addCategoryModalLabel">Add New Category</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <form id="categoryForm" action="/category" method="POST">
        <div class="modal-body">
          <div class="mb-3">
            <label for="name" class="form-label">Category Name</label>
            <input type="text" class="form-control" name="name" id="name" required />
          </div>
          <div class="mb-3">
            <label for="desc" class="form-label">Description</label>
            <textarea class="form-control" name="description" id="desc" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button id="saveCategory" type="submit" class="btn btn-success">Save Category</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.getElementById("categoryForm").addEventListener("submit", function () {
    let btn = document.getElementById("saveCategory");
    btn.disabled = true; // disable to prevent double-click
    btn.innerHTML = `
        <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
        <span role="status"> Loading...</span>
    `;
    setTimeout(() => {
    }, 3000);
  });
</script>

<%- include('../partials/fixedFooter.ejs') %>
